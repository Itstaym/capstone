<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borrow/Return History</title>
    <link rel="stylesheet" href="borrow_return_history.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <header>
        <div class="title-logo">
            <img src="https://www.paterostechnologicalcollege.edu.ph/ASSETS/IMAGES/LOGO/logo-ptc.png" alt="PTC Logo" class="logo">
            <h1>PTC Booklink: Library Management System</h1>
        </div>
        <nav>
            <a href="main.html">Dashboard</a>
            <a href="books.html">Books</a>
            <a href="members.html">Users</a>
            <a href="issue and return.html">Borrow and Returns</a>
            <a href="borrow_return history.html">Borrow/Return History</a>
        </nav>
        <div>
            <button id="logoutBtn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </header>

    <h2 style="text-align:center; margin-top:20px;">User Borrow/Return History</h2>

    <!-- Report Generation Buttons -->
    <div class="report-buttons" style="text-align:center; margin:20px;">
        <button onclick="generateExcel()">Generate Excel Report</button>
        <button onclick="generatePDF()">Generate PDF Report</button>
    </div>

    <!-- History Table -->
    <div class="history-table-container">
        <table class="history-table" id="historyTable">
            <thead>
                <tr>
                    <th>User Name</th>
                    <th>Email</th>
                    <th>Book Title</th>
                    <th>Author</th>
                    <th>Date & Time BORROWED</th>
                    <th>Date & Time RETURNED</th>
                </tr>
            </thead>
            <tbody>
                <!-- Example entries -->
                <tr>
                    <td>Juan Dela Cruz</td>
                    <td>example@paterostechnologicalcollege.edu.ph</td>
                    <td>Noli Me Tangere</td>
                    <td>Jose Rizal</td>
                    <td>2023-10-01 2:30PM</td>
                    <td>2023-10-01 4:00PM</td>
                </tr>
                <tr>
                    <td>Maria Clara</td>
                    <td>example@paterostechnologicalcollege.edu.ph</td>
                    <td>El Filibusterismo</td>
                    <td>Jose Rizal</td>
                    <td>2023-10-05 10:15AM</td>
                    <td>2023-10-05 1:15PM</td>
                </tr>
            </tbody>
        </table>
    </div>

    <footer>
        <p id="currentTime"></p>
    </footer>

    <script>
        // Function to generate Excel report
        function generateExcel() {
            const table = document.getElementById("historyTable");
            const workbook = XLSX.utils.table_to_book(table, { sheet: "Borrow/Return History" });
            XLSX.writeFile(workbook, "Borrow_Return_History.xlsx");
        }

        // Function to generate PDF report
        function generatePDF() {
            const table = document.getElementById("historyTable");
            const rows = Array.from(table.rows).map(row => Array.from(row.cells).map(cell => cell.textContent));
            const doc = new jsPDF();

            doc.text("Borrow/Return History", 10, 10);
            doc.autoTable({
                head: [rows[0]],
                body: rows.slice(1),
            });

            doc.save("Borrow_Return_History.pdf");
        }

        // Display current time in footer
        function showTime() {
            document.getElementById('currentTime').innerHTML = new Date().toLocaleString();
        }
        showTime();
        setInterval(showTime, 1000);

    
    if (!sessionStorage.getItem('isLoggedIn')) {
      alert('Nag-logout ka noh? Login ka ulit!');
      window.location.href = '../../main_login/main_login.html'; 
    }
    function logout() {
      sessionStorage.removeItem('isLoggedIn'); 
      window.location.href = '../../main_login/main_login.html'; 
    }
</script>
</body>
</html>